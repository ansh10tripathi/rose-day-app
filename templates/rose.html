<!DOCTYPE html>
<html>
<head>
    <title>A Rose For You</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="theme-switch" id="themeToggle">
        <span class="icon sun">â˜€ï¸</span>
        <span class="icon moon">ğŸŒ™</span>
        <div class="switch-knob"></div>
    </div>

<div class="card">
    <div class="title-top">
        ğŸŒ¹ <span class="title-text">A Rose For ğŸŒ¹</span>
    </div>

    <div class="name-bottom">
        {{ rose.name }} â¤ï¸â¤ï¸
    </div>
    <div class="message-box">
        <button id="revealBtn" class="reveal-btn">
            ğŸ’Œ Tap to Reveal
        </button>

        <span id="typewriter" style="display:none;"></span>
    </div>



    <!-- Hidden full message -->
    <span id="fullMessage" style="display:none;">
        {{ rose.message }}
    </span>


    <div class="hearts">
        <span>â¤ï¸</span>
        <span>ğŸ’•</span>
        <span>ğŸ’–</span>
        <span>ğŸ’—</span>
        <span>â¤ï¸</span>
    </div>

    <!-- <p class="hint">Some messages donâ€™t require any words</p> -->
</div>
</body>

<script>
document.addEventListener("DOMContentLoaded", function () {

    /* ğŸ’Œ TYPEWRITER + REVEAL */
    const fullMessageEl = document.getElementById("fullMessage");
    const target = document.getElementById("typewriter");
    const revealBtn = document.getElementById("revealBtn");

    let index = 0;
    const speed = 40;

    function typeEffect(text) {
        if (index < text.length) {
            target.innerHTML += text.charAt(index);
            index++;

            // ğŸ”¥ AUTO-SCROLL FIX
            const box = document.querySelector(".message-box");
            box.scrollTop = box.scrollHeight;

            setTimeout(() => typeEffect(text), speed);
        }
    }

    revealBtn.addEventListener("click", function () {
        revealBtn.style.display = "none";
        target.style.display = "inline";
        target.innerHTML = "";
        index = 0;

        const text = fullMessageEl.innerText.trim();
        typeEffect(text);
    });

    /* ğŸŒ— PILL-STYLE LIGHT / DARK TOGGLE */
    const toggle = document.getElementById("themeToggle");
    const body = document.body;

    // Restore saved theme
    if (localStorage.getItem("theme") === "dark") {
        body.classList.add("dark-mode");
    }

    toggle.addEventListener("click", function () {
        body.classList.toggle("dark-mode");

        if (body.classList.contains("dark-mode")) {
            localStorage.setItem("theme", "dark");
        } else {
            localStorage.setItem("theme", "light");
        }
    });

    /* ğŸŒ« Fade toggle on idle */
    let idleTimer;
    const fadeDelay = 3000; // 3 seconds

    function setIdle() {
        toggle.classList.add("idle");
    }

    function resetIdle() {
        toggle.classList.remove("idle");
        clearTimeout(idleTimer);
        idleTimer = setTimeout(setIdle, fadeDelay);
    }

    // Start idle timer
    idleTimer = setTimeout(setIdle, fadeDelay);

    // Wake on interaction
    ["mousemove", "scroll", "click", "touchstart"].forEach(event => {
        window.addEventListener(event, resetIdle);
    });

});
</script>

</html>